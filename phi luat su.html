<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="vi"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;Công cụ tính phí luật sư&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&amp;display=swap" rel="stylesheet"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>body {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: 'Inter', sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #f3f4f6;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body class="flex items-center justify-center min-h-screen p-4"&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-lg space-y-6 transform transition-all hover:scale-105 duration-300"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="text-center"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h1 class="text-3xl font-bold text-gray-800"&gt;Tính Phí Luật Sư&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p class="text-gray-500 mt-2"&gt;Tính phí thù lao và tiền cọc theo hợp đồng.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;label for="contractValue" class="block text-sm font-medium text-gray-700 mb-1"&gt;Tổng giá trị hợp đồng sau thuế (VND)&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;input type="number" id="contractValue" placeholder="Nhập giá trị hợp đồng..." class="mt-1 block w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500 transition-colors duration-200"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="grid grid-cols-1 md:grid-cols-2 gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label for="ownerName" class="block text-sm font-medium text-gray-700 mb-1"&gt;Họ tên Chủ Sở Hữu&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;input type="text" id="ownerName" placeholder="Nhập họ tên..." class="mt-1 block w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500 transition-colors duration-200"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label for="contractId" class="block text-sm font-medium text-gray-700 mb-1"&gt;Mã hợp đồng&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;input type="text" id="contractId" placeholder="Nhập mã hợp đồng..." class="mt-1 block w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500 transition-colors duration-200"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label for="apartmentId" class="block text-sm font-medium text-gray-700 mb-1"&gt;Mã căn&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;input type="text" id="apartmentId" placeholder="Nhập mã căn..." class="mt-1 block w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500 transition-colors duration-200"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label for="contactPhone" class="block text-sm font-medium text-gray-700 mb-1"&gt;Số điện thoại liên hệ&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;input type="tel" id="contactPhone" placeholder="Nhập số điện thoại..." class="mt-1 block w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500 transition-colors duration-200"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="calculateBtn" class="w-full bg-sky-600 text-white font-semibold py-3 rounded-md shadow-lg hover:bg-sky-700 transition-transform transform hover:scale-105 duration-200"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>Tính toán</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/button&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="results" class="hidden space-y-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="bg-sky-100 p-4 rounded-md border border-sky-200 shadow-inner"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p class="text-sm font-medium text-sky-700"&gt;Phí thù lao luật sư (15%):&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p id="lawyerFee" class="text-xl font-bold text-sky-900 mt-1"&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="bg-gray-100 p-4 rounded-md border border-gray-200 shadow-inner"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p class="text-sm font-medium text-gray-700"&gt;Tổng tiền cọc (4% của phí thù lao):&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p id="totalDeposit" class="text-xl font-bold text-gray-900 mt-1"&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="bg-gray-100 p-4 rounded-md border border-gray-200 shadow-inner"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p class="text-sm font-medium text-gray-700"&gt;Số tiền cọc chia làm 3 lần:&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;ul id="depositInstallments" class="list-disc list-inside space-y-1 mt-2 text-lg font-bold text-gray-900"&gt;&lt;/ul&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button id="generateEmailBtn" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-md shadow-lg hover:bg-indigo-700 transition-transform transform hover:scale-105 duration-200 flex items-center justify-center space-x-2"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;span&gt;✨ Soạn Email Thanh Toán&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="emailSection" class="hidden space-y-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="bg-gray-200 p-4 rounded-md border border-gray-300 shadow-inner"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p class="text-sm font-medium text-gray-700"&gt;Bản nháp email:&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;pre id="emailDraft" class="mt-2 p-2 bg-gray-50 border border-gray-300 rounded-md text-gray-800 text-sm whitespace-pre-wrap"&gt;&lt;/pre&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button id="copyEmailBtn" class="mt-4 w-full bg-green-600 text-white font-semibold py-2 rounded-md hover:bg-green-700 transition-colors duration-200"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>Sao chép Email</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Message Box --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div id="messageBox" class="hidden mt-4 p-4 text-center rounded-md text-sm transition-all duration-300"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>// Get all necessary elements from the DOM</p>
<p class="p1"><span class="Apple-converted-space">        </span>const contractInput = document.getElementById('contractValue');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const ownerNameInput = document.getElementById('ownerName');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const contractIdInput = document.getElementById('contractId');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const apartmentIdInput = document.getElementById('apartmentId');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const contactPhoneInput = document.getElementById('contactPhone');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const calculateBtn = document.getElementById('calculateBtn');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const resultsDiv = document.getElementById('results');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const lawyerFeeSpan = document.getElementById('lawyerFee');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const totalDepositSpan = document.getElementById('totalDeposit');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const installmentsList = document.getElementById('depositInstallments');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const messageBox = document.getElementById('messageBox');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const generateEmailBtn = document.getElementById('generateEmailBtn');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const emailSection = document.getElementById('emailSection');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const emailDraft = document.getElementById('emailDraft');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const copyEmailBtn = document.getElementById('copyEmailBtn');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Function to format a number as Vietnamese Dong (VND)</p>
<p class="p1"><span class="Apple-converted-space">        </span>const formatVND = (amount) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>return new Intl.NumberFormat('vi-VN', {</p>
<p class="p1"><span class="Apple-converted-space">                </span>style: 'currency',</p>
<p class="p1"><span class="Apple-converted-space">                </span>currency: 'VND'</p>
<p class="p1"><span class="Apple-converted-space">            </span>}).format(amount);</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Function to show a message to the user</p>
<p class="p1"><span class="Apple-converted-space">        </span>const showMessage = (text, type = 'error') =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>messageBox.textContent = text;</p>
<p class="p1"><span class="Apple-converted-space">            </span>messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700', 'bg-yellow-100', 'text-yellow-700');</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (type === 'error') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>messageBox.classList.add('bg-red-100', 'text-red-700');</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else if (type === 'success') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>messageBox.classList.add('bg-green-100', 'text-green-700');</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else if (type === 'loading') {</p>
<p class="p1"><span class="Apple-converted-space">                 </span>messageBox.classList.add('bg-yellow-100', 'text-yellow-700');</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Main calculation function</p>
<p class="p1"><span class="Apple-converted-space">        </span>const calculateFees = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const contractValue = parseFloat(contractInput.value);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Hide previous results and messages</p>
<p class="p1"><span class="Apple-converted-space">            </span>resultsDiv.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>emailSection.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>messageBox.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>installmentsList.innerHTML = '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Input validation</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (isNaN(contractValue) || contractValue &lt;= 0) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage('Vui lòng nhập giá trị hợp đồng hợp lệ.', 'error');</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Calculations based on the rules</p>
<p class="p1"><span class="Apple-converted-space">            </span>const lawyerFee = contractValue * 0.15;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const totalDeposit = lawyerFee * 0.04;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const depositPerInstallment = totalDeposit / 3;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Display results</p>
<p class="p1"><span class="Apple-converted-space">            </span>lawyerFeeSpan.textContent = formatVND(lawyerFee);</p>
<p class="p1"><span class="Apple-converted-space">            </span>totalDepositSpan.textContent = formatVND(totalDeposit);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Create and display the list items with specific details</p>
<p class="p1"><span class="Apple-converted-space">            </span>const li1 = document.createElement('li');</p>
<p class="p1"><span class="Apple-converted-space">            </span>li1.textContent = `Lần 1: ${formatVND(depositPerInstallment)} - nộp vào tài khoản BDĐ (Techcombank- Nguyen Thi Thanh Huyen), đồng thời gửi email thông báo tới info@congdongcshalma1.com.`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>installmentsList.appendChild(li1);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const li2 = document.createElement('li');</p>
<p class="p1"><span class="Apple-converted-space">            </span>li2.textContent = `Lần 2: ${formatVND(depositPerInstallment)} - nộp cho luật sư`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>installmentsList.appendChild(li2);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const li3 = document.createElement('li');</p>
<p class="p1"><span class="Apple-converted-space">            </span>li3.textContent = `Lần 3: ${formatVND(depositPerInstallment)} - nộp cho luật sư`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>installmentsList.appendChild(li3);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>resultsDiv.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>showMessage('Tính toán thành công!', 'success');</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// --- Gemini API Integration ---</p>
<p class="p1"><span class="Apple-converted-space">        </span>const generatePaymentEmail = async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>// Get calculated values</p>
<p class="p1"><span class="Apple-converted-space">            </span>const contractValue = parseFloat(contractInput.value);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const lawyerFee = contractValue * 0.15;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const totalDeposit = lawyerFee * 0.04;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const depositPerInstallment = totalDeposit / 3;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Get user info</p>
<p class="p1"><span class="Apple-converted-space">            </span>const ownerName = ownerNameInput.value.trim();</p>
<p class="p1"><span class="Apple-converted-space">            </span>const contractId = contractIdInput.value.trim();</p>
<p class="p1"><span class="Apple-converted-space">            </span>const apartmentId = apartmentIdInput.value.trim();</p>
<p class="p1"><span class="Apple-converted-space">            </span>const contactPhone = contactPhoneInput.value.trim();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Check if all necessary fields are filled</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!ownerName || !contractId || !apartmentId || !contactPhone) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage('Vui lòng điền đầy đủ thông tin Chủ Sở Hữu, Mã hợp đồng, Mã căn và Số điện thoại trước khi soạn email.', 'error');</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Define the prompt for the LLM</p>
<p class="p1"><span class="Apple-converted-space">            </span>const userQuery = `Dựa trên các thông tin sau, hãy soạn một email chuyên nghiệp, lịch sự để gửi cho khách hàng, thông báo về chi tiết thanh toán cho hợp đồng.</p>
<p class="p1"><span class="Apple-converted-space">            </span>Thông tin hợp đồng:</p>
<p class="p1"><span class="Apple-converted-space">            </span>- Họ tên Chủ Sở Hữu: ${ownerName}</p>
<p class="p1"><span class="Apple-converted-space">            </span>- Mã hợp đồng: ${contractId}</p>
<p class="p1"><span class="Apple-converted-space">            </span>- Mã căn: ${apartmentId}</p>
<p class="p1"><span class="Apple-converted-space">            </span>- Số điện thoại liên hệ: ${contactPhone}</p>
<p class="p1"><span class="Apple-converted-space">            </span>- Tổng giá trị hợp đồng: ${formatVND(contractValue)}.</p>
<p class="p1"><span class="Apple-converted-space">            </span>- Phí thù lao luật sư: ${formatVND(lawyerFee)}.</p>
<p class="p1"><span class="Apple-converted-space">            </span>- Tổng tiền cọc: ${formatVND(totalDeposit)}.</p>
<p class="p1"><span class="Apple-converted-space">            </span>- Chi tiết 3 lần nộp cọc:</p>
<p class="p1"><span class="Apple-converted-space">            </span>- Lần 1: ${formatVND(depositPerInstallment)}, nộp vào tài khoản BDĐ (Techcombank- Nguyen Thi Thanh Huyen) và gửi email thông báo tới info@congdongcshalma1.com.</p>
<p class="p1"><span class="Apple-converted-space">            </span>- Lần 2: ${formatVND(depositPerInstallment)}, nộp cho luật sư.</p>
<p class="p1"><span class="Apple-converted-space">            </span>- Lần 3: ${formatVND(depositPerInstallment)}, nộp cho luật sư.</p>
<p class="p1"><span class="Apple-converted-space">            </span>Sử dụng ngôn ngữ trang trọng và rõ ràng, kết thúc bằng lời cảm ơn.`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Define system instructions</p>
<p class="p1"><span class="Apple-converted-space">            </span>const systemPrompt = "Bạn là một trợ lý pháp lý chuyên nghiệp, chuyên soạn thảo các văn bản và email liên quan đến hợp đồng. Hãy đảm bảo nội dung email rõ ràng, đầy đủ và lịch sự.";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Show a loading message</p>
<p class="p1"><span class="Apple-converted-space">            </span>showMessage('Đang soạn bản nháp email...', 'loading');</p>
<p class="p1"><span class="Apple-converted-space">            </span>emailSection.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>generateEmailBtn.disabled = true;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const apiKey = "";</p>
<p class="p1"><span class="Apple-converted-space">            </span>const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const payload = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>contents: [{ parts: [{ text: userQuery }] }],</p>
<p class="p1"><span class="Apple-converted-space">                </span>systemInstruction: {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>parts: [{ text: systemPrompt }]</p>
<p class="p1"><span class="Apple-converted-space">                </span>},</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const response = await fetch(apiUrl, {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>method: 'POST',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>headers: { 'Content-Type': 'application/json' },</p>
<p class="p1"><span class="Apple-converted-space">                    </span>body: JSON.stringify(payload)</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!response.ok) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>throw new Error(`API call failed with status: ${response.status}`);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const result = await response.json();</p>
<p class="p1"><span class="Apple-converted-space">                </span>const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (text) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>emailDraft.textContent = text;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>emailSection.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showMessage('Bản nháp email đã sẵn sàng!', 'success');</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>throw new Error('Không nhận được phản hồi hợp lệ từ API.');</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error('Lỗi khi gọi API Gemini:', error);</p>
<p class="p1"><span class="Apple-converted-space">                </span>showMessage('Đã xảy ra lỗi khi soạn email. Vui lòng thử lại.', 'error');</p>
<p class="p1"><span class="Apple-converted-space">            </span>} finally {</p>
<p class="p1"><span class="Apple-converted-space">                </span>generateEmailBtn.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p1"><span class="Apple-converted-space">        </span>// --- End of Gemini API Integration ---</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Function to copy email text to clipboard</p>
<p class="p1"><span class="Apple-converted-space">        </span>const copyEmailToClipboard = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>navigator.clipboard.writeText(emailDraft.textContent)</p>
<p class="p1"><span class="Apple-converted-space">                </span>.then(() =&gt; showMessage('Đã sao chép email vào khay nhớ tạm.', 'success'))</p>
<p class="p1"><span class="Apple-converted-space">                </span>.catch(err =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.error('Lỗi khi sao chép:', err);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showMessage('Không thể sao chép email. Vui lòng sao chép thủ công.', 'error');</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Add event listeners</p>
<p class="p1"><span class="Apple-converted-space">        </span>calculateBtn.addEventListener('click', calculateFees);</p>
<p class="p1"><span class="Apple-converted-space">        </span>generateEmailBtn.addEventListener('click', generatePaymentEmail);</p>
<p class="p1"><span class="Apple-converted-space">        </span>copyEmailBtn.addEventListener('click', copyEmailToClipboard);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Optional: Add event listener for Enter key on the input field</p>
<p class="p1"><span class="Apple-converted-space">        </span>contractInput.addEventListener('keypress', (event) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (event.key === 'Enter') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>event.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">                </span>calculateFees();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
